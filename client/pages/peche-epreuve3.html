<template name="pecheEpreuve3">
  <img id="scenep3" class="scene" src="/img/salle3.gif"/>
  <img id="persop3" src="/img/perso.png">
  <div id="chat">
    <div class="pp">
      <img src="/img/peche.png" />
      <h4>Peche Refraction</h4>
    </div>
    <p class="msg1">On y est presque, la sortie est là-bas.</p>
    <p class="msg2">Mince ! La cape s’est déchirée. On ferait mieux de la réparer tant que nous sommes ici.</p>
    <p class="msg3">Il est temps de fuir !</p>
  </div>
  <img id="livretIcon" src="/img/livretoff.png" onclick="livretModal()">
  <img id="livret" src="/img/schema3.png">
  <img id="scratch" src="/img/scratch.gif">
  <img id="controle" src="/img/controle.png">
  <div id="next">
    <h3>Tu as déchiré ta cape !</h3>
    <div class="text">Pour la réparer, trouve l'établi !</div>
    <div id="okButton" onclick="hideNext()">Ok</div>
  </div>
  <div id="next2">
    <h3>Tu as trouvé l'établi</h3>
    <div class="text">Il y'a les composants nécessaires pour recontruire la cape</div>
    <div id="etabliButton" onclick="etabli()">C'est parti</div>
  </div>
  <div id="next3">
    <h3>La sortie</h3>
    <div class="text">Vous tentez de fuire du laboratoire...</div>
    <div id="endButton" onclick="window.location = 'news'">Suite</div>
  </div>


  <!-- Scripts -->
  <script>
  var next = document.querySelector('#next'),
  next2 = document.querySelector('#next2'),
  next3 = document.querySelector('#next3')

  function hideNext() {
    next.style.display = 'none'
  }

  function etabli() {
    window.open('pecheEpreuve3b','_blank')
    next2.style.display = 'none'
    cape = 'on'
    perso.src = '/img/persobg.png'
  }

  var scratch = document.querySelector('#scratch'),
  cape = 'on'

  var livretIcon = document.querySelector('#livretIcon'),
  livret = document.querySelector('#livret'),
  modal = "off"

  function livretModal(){
    if (modal == "off"){
      livretIcon.src = "/img/livreton.png"
      modal = "on"
      livret.style.right = "0"
    } else {
      livretIcon.src = "/img/livretoff.png"
      modal = "off"
      livret.style.right = "-700px"
    }
  }

  var msg1 = document.querySelector('.msg1'),
  msg2 = document.querySelector('.msg2'),
  msg3 = document.querySelector('.msg3')

  setTimeout(function(){
    msg1.style.display = "block"
  }, 1000);
  setTimeout(function(){
    msg3.style.display = "block"
  }, 45000);

  var perso = document.querySelector('#persop3'),
  scene = document.querySelector('#scenep3'),
  marginLeft = 0,
  marginTop = 0,
  lock = 'off'

  function hautDroite() {
    marginTop -= 15;
    perso.style.marginTop =  marginTop + 'px';
    marginLeft += 25;
    perso.style.marginLeft =  marginLeft + 'px';
    if (cape == 'on'){
      if ( lock == "on"){
        console.log('hg lock')
      } else {
        perso.src = "/img/persohd.gif";
        setTimeout(function(){
          perso.src = '/img/persohd.png'
        }, 200);
        console.log('hg')
      }
    } else if (cape == 'off'){
      perso.src = "/img/persoshd.gif";
    }
  }

  function stopHautDroite(){
    perso.src = '/img/persostop.gif';
    setTimeout(function(){
      perso.src = '/img/persohd.png'
    }, 1000);
  }

  function basGauche() {
    marginTop += 15;
    perso.style.marginTop =  marginTop + 'px';
    marginLeft -= 25;
    perso.style.marginLeft =  marginLeft + 'px';
    if (cape == 'on'){
      if ( lock == "on"){
        console.log('hg lock')
      } else {
        perso.src = "/img/persobg.gif";
        setTimeout(function(){
          perso.src = '/img/persobg.png'
        }, 200);
        console.log('hg')
      }
    } else if (cape == 'off'){
      perso.src = "/img/persosbg.gif";
    }
  }

  function stopBasGauche(){
    perso.src = '/img/persostop.gif';
    setTimeout(function(){
      perso.src = '/img/persobg.png'
    }, 1000);
  }

  function basDroite() {
    marginTop += 15;
    perso.style.marginTop =  marginTop + 'px';
    marginLeft += 25;
    perso.style.marginLeft =  marginLeft + 'px';
    if (cape == 'on'){
      if ( lock == "on"){
        console.log('hg lock')
      } else {
        perso.src = "/img/persobd.gif";
        setTimeout(function(){
          perso.src = '/img/persobd.png'
        }, 200);
        console.log('hg')
      }
    } else if (cape == 'off'){
      perso.src = "/img/persosbd.gif";
    }
  }

  function stopBasDroite(){
    perso.src = '/img/persostop.gif';
    setTimeout(function(){
      perso.src = '/img/persobd.png'
    }, 1000);
  }

  function hautGauche() {
    marginTop -= 15;
    perso.style.marginTop =  marginTop + 'px';
    marginLeft -= 25;
    perso.style.marginLeft =  marginLeft + 'px';
    if (cape == 'on'){
      if ( lock == "on"){
        console.log('hg lock')
      } else {
        perso.src = "/img/persohg.gif";
        setTimeout(function(){
          perso.src = '/img/persohg.png'
        }, 200);
        console.log('hg')
      }
    } else if (cape == 'off'){
      perso.src = "/img/persoshg.gif";
    }
  }

  function stopHautGauche(){
    perso.src = '/img/persostop.gif';
    setTimeout(function(){
      perso.src = '/img/persohg.png'
    }, 1000);
  }

  document.onkeydown = checkKey;
  function checkKey(e) {
    // HAUT DROITE
    if (e.keyCode == '38') {
      if (marginTop == 15 && marginLeft == 75){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -15 && marginLeft == 25){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -180 && marginLeft == 200){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -195 && marginLeft == -225){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == 0 && marginLeft == 50){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -30 && marginLeft == 0){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -15 && marginLeft == -75){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -30 && marginLeft == -100){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -45 && marginLeft == -125){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -60 && marginLeft == -150){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -90 && marginLeft == -150){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -210 && marginLeft == 50){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -225 && marginLeft == 25){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -240 && marginLeft == 0){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          next2.style.display = 'block'
        }
      } else if (marginTop == -255 && marginLeft == -25){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -270 && marginLeft == -50){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else if (marginTop == -285 && marginLeft == -75){
        if (cape == 'on'){
          perso.src = "/img/persohd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshd.gif"
        }
      } else {
        hautDroite()
      }
    // BAS GAUCHE
    } else if (e.keyCode == '40') {
      if (marginTop == 30 && marginLeft == 50){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == 15 && marginLeft == 25){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == 45 && marginLeft == -75){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == 30 && marginLeft == -100){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -15 && marginLeft == -75){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -30 && marginLeft == -100){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -45 && marginLeft == -125){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -60 && marginLeft == -150){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -75 && marginLeft == -175){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -90 && marginLeft == -200){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -30 && marginLeft == -350){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -45 && marginLeft == -375){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -75 && marginLeft == -425){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == 90 && marginLeft == -450){
        if (cape == 'on'){
          perso.src = "/img/persobg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else if (marginTop == -60 && marginLeft == -400){
        if (cape == 'on'){
          next3.style.display = "block"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbg.gif"
        }
      } else {
        basGauche()
      }
    // HAUT GAUCHE
    } else if (e.keyCode == '37') {
      if (marginTop == -30 && marginLeft == 0){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -15 && marginLeft == -25){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == 15 && marginLeft == -75){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == 30 && marginLeft == -100){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -255 && marginLeft == -25){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -240 && marginLeft == -50){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -225 && marginLeft == -75){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -210 && marginLeft == -100){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -195 && marginLeft == -125){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -180 && marginLeft == -150){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -195 && marginLeft == -225){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -180 && marginLeft == -250){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -165 && marginLeft == -275){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -150 && marginLeft == -300){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -135 && marginLeft == -325){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -120 && marginLeft == -350){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -105 && marginLeft == -375){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -90 && marginLeft == -400){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -75 && marginLeft == -425){
        if (cape == 'on'){
          perso.src = "/img/persohg.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persoshg.gif"
        }
      } else if (marginTop == -60 && marginLeft == -150){
        scratch.style.display = 'inline'
        msg2.style.display = "block"
        setTimeout(function(){
          scratch.style.display = 'none'
        }, 800);
        cape = 'off'
        hautGauche()
        perso.src = '/img/persoshg.gif'
        setTimeout(function(){
         next.style.display = 'block'
        }, 1000);
      } else {
        hautGauche()
      }
    // BAS DROITE
    } else if (e.keyCode == '39') {
      if (marginTop == 15 && marginLeft == 75){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == 30 && marginLeft == 50){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == 15 && marginLeft == -25){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == 30 && marginLeft == -50){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == 45 && marginLeft == -75){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -120 && marginLeft == -150){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -135 && marginLeft == -125){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -150 && marginLeft == -100){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -165 && marginLeft == -75){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -180 && marginLeft == -50){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -195 && marginLeft == -25){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -210 && marginLeft == 0){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -225 && marginLeft == 25){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -105 && marginLeft == -225){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -90 && marginLeft == -250){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -75 && marginLeft == -275){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -60 && marginLeft == -300){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -45 && marginLeft == -325){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -30 && marginLeft == -350){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else if (marginTop == -90 && marginLeft == -150){
        if (cape == 'on'){
          perso.src = "/img/persobd.png"
        }  else if (cape == 'off') {
          perso.src = "/img/persosbd.gif"
        }
      } else {
        basDroite()
      }
    } else if (e.keyCode == '86'){
      if ( lock == 'off'){
        lock = "on";
        console.log('switch lock on')
      } else {
        lock = "off";
        console.log('switch lock off')
      }
    }
  }
  </script>

